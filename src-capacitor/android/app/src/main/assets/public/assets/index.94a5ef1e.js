import{q as Q,Y as I,Z as x,c as S,h as B,x as M,g as z,_ as N,d as P,L as f,M as G,u as R,l as r,m as g,n as y,O as d,P as v,Q as c,f as p,R as D,$ as k,a0 as L,F as A,a1 as E,S as T,a2 as C,U as b,p as F,a3 as w,a4 as V,a5 as j}from"./index.34ef79da.js";import{Q as W,a as J}from"./QPage.d5dd3d12.js";const O=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],U=["wave","pulse","pulse-x","pulse-y","fade","blink","none"];var Y=Q({name:"QSkeleton",props:{...I,tag:{type:String,default:"div"},type:{type:String,validator:e=>O.includes(e),default:"rect"},animation:{type:String,validator:e=>U.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:s}){const t=z(),n=x(e,t.proxy.$q),l=S(()=>{const a=e.size!==void 0?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:a[0],height:a[1]}}),h=S(()=>`q-skeleton q-skeleton--${n.value===!0?"dark":"light"} q-skeleton--type-${e.type}`+(e.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(e.square===!0?" q-skeleton--square":"")+(e.bordered===!0?" q-skeleton--bordered":""));return()=>B(e.tag,{class:h.value,style:l.value},M(s.default))}});const Z=P({name:"WaitingRoom",setup(){const e=f(),s=G(),t=R();return{sessionStore:e,layoutStore:s,firebaseStore:t}},async mounted(){this.loadingCharacters=!0,await this.firebaseStore.getCharacters().then(e=>{this.sessionStore.characters=Array.from(e)}),this.loadingCharacters=!1},beforeRouteEnter(e,s,t){f().game.id?t():t(s)},beforeRouteLeave(e,s,t){if(e.path==="/game")return t();this.sessionStore.game.id&&this.sessionStore.game.status!=="started"?(t(s),this.layoutStore.exitGameDialog=!0):t()},data(){return{loadingCharacters:!1}},watch:{"sessionStore.game":{handler:function(e){e.id?e.status==="started"&&this.$router.push("/game"):this.$router.push("/home")},deep:!0}},methods:{async setPlayer(e){const s=this.sessionStore.game.players.findIndex(n=>{var l;return n.id===((l=this.sessionStore.playerSelected)==null?void 0:l.id)});s>=0&&this.sessionStore.game.players.splice(s,1);const t={...e,isNpc:!1,isActive:!1,userId:`/user/${this.sessionStore.user.id}`,cards:[],checklist:[],suspicious:[]};this.sessionStore.game.players.push(t),this.sessionStore.playerSelected=t,await this.firebaseStore.updateGame(this.sessionStore.game)},setBots(){this.sessionStore.characters.forEach(e=>{if(this.sessionStore.game.players.length<this.sessionStore.game.qtdPlayers&&this.sessionStore.game.players.every(s=>s.name!==e.name)){const s={...e,isNpc:!0,isActive:!1,userId:"",cards:[],checklist:[],suspicious:[]};this.sessionStore.game.players.push(s)}}),this.giveCards()},async giveCards(){const e=this.sessionStore.cards.filter(i=>i.category==="character"),s=this.sessionStore.cards.filter(i=>i.category==="weapon"),t=this.sessionStore.cards.filter(i=>i.category==="place"),n=e[Math.floor(Math.random()*e.length)],l=s[Math.floor(Math.random()*s.length)],h=t[Math.floor(Math.random()*t.length)];this.sessionStore.game.targets=[n,l,h];const a=this.shuffle(this.sessionStore.cards),u=[];let o=0;console.log("randomCards",a),a.forEach(i=>{const q=this.sessionStore.game.targets.find(m=>m.id===i.id),$=u.find(m=>m.id===i.id);q||$||(this.sessionStore.game.players[o].cards.push(i),this.sessionStore.game.players[o].checklist.push(i),u.push(i),o<this.sessionStore.game.qtdPlayers-1?o++:o=0)}),this.startGame()},async startGame(){this.sessionStore.game.status="started",this.layoutStore.loadingLayout=!0,await this.firebaseStore.updateGame(this.sessionStore.game).then(()=>{this.$router.push("/game")}),this.layoutStore.loadingLayout=!1},shuffle(e){let s=e.length,t;for(;s>0;)t=Math.floor(Math.random()*s),s--,[e[s],e[t]]=[e[t],e[s]];return e}}}),_=e=>(V("data-v-41965bf2"),e=e(),j(),e),H={class:"config-icon absolute-left q-pa-md"},K={class:"relative-position"},X={class:"text-h6 q-mb-sm full-width flex flex-center"},ee=_(()=>d("span",null,"Sala:",-1)),se={class:"q-ml-sm text-primary"},te=_(()=>d("div",{class:"text-h5 text-primary text-bold q-mb-sm"}," Escolha seu personagem ",-1)),ae={class:"characters-container"},oe=["onClick"],ie={key:0};function re(e,s,t,n,l,h){return r(),g(W,{class:"container shadow-21 row items-center justify-evenly q-pa-md"},{default:y(()=>[d("div",H,[v((r(),c("div",K,[p(D,{class:"cursor-pointer",color:"info",name:"arrow_back",size:"32px",onClick:s[0]||(s[0]=a=>e.$router.push("/home"))})])),[[b]])]),p(E,{class:"q-pa-md shadow-21"},{default:y(()=>[d("div",X,[ee,d("span",se,k(e.sessionStore.game.room),1)]),te,d("div",ae,[(r(!0),c(A,null,L(e.loadingCharacters?6:e.sessionStore.characters,(a,u)=>v((r(),c("div",{class:F(["character-card cursor-pointer relative-position",{"player-selected shadow-21":e.sessionStore.game.players.some(o=>o.name===a.name&&!o.isNpc),"player-out-game":e.sessionStore.game.players.every(o=>o.name!==a.name)}]),key:u,onClick:o=>e.setPlayer(a)},[e.loadingCharacters?(r(),c("div",ie,[p(Y,{width:"91px",height:"128px"})])):(r(),g(J,{key:1,height:"100%",width:"100%",src:`img/cards/${a.name}.jpg`},null,8,["src"])),e.sessionStore.game.players.some(o=>o.name===a.name&&!o.isNpc)?(r(),c("div",{key:2,class:"username-container",style:w(`border: 5px solid var(--${a.name}-color);`)},[d("div",{class:"username ellipsis",style:w(`background: var(--${a.name}-color); color: ${a.name==="white"?"#000":"#fff"}`)},k(e.sessionStore.user.name),5)],4)):C("",!0)],10,oe)),[[b]])),128))])]),_:1}),e.sessionStore.game.ownerId===e.sessionStore.user.id?(r(),g(T,{key:0,disable:!e.sessionStore.playerSelected.name,class:"full-width",color:"primary",label:"Iniciar Jogo",onClick:e.setBots},null,8,["disable","onClick"])):C("",!0)]),_:1})}var de=N(Z,[["render",re],["__scopeId","data-v-41965bf2"]]);export{de as default};
